<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>SGI Hello world TP1</title>

        <link rel="shortcut icon" href="image/favicon/3d.png" />
        <link rel="stylesheet" href="styles.css" />

        <script
            async
            src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"
        ></script>
        <script type="importmap">
            {
                "imports": {
                    "three": "https://unpkg.com/three@0.156.1/build/three.module.js",
                    "three/addons/": "https://unpkg.com/three@0.156.1/examples/jsm/"
                }
            }
        </script>

        <script id="vertexPowerUpShader" type="x-shader/x-vertex">
            uniform float time;
            uniform float rotationSpeed;
            uniform float pumpRange;
            uniform float pumpSpeed;
            varying vec2 vUv;

            mat4 rotateY(float theta) {
              float c = cos(theta);
              float s = sin(theta);

              return mat4(
                vec4(c, 0, s, 0),
                vec4(0, 1, 0, 0),
                vec4(-s, 0, c, 0),
                vec4(0, 0, 0, 1)
              );
            }

            mat4 rotateZ(float theta) {
              float c = cos(theta);
              float s = sin(theta);

              return mat4(
                vec4(c, -s, 0, 0),
                vec4(s, c, 0, 0),
                vec4(0, 0, 1, 0),
                vec4(0, 0, 0, 1)
              );
            }

            void main()	{
                vUv = uv;

                float pump = mod(time * pumpSpeed, 2.0);

                if (pump > 1.0) {
                  pump = 2.0 - pump;
                }

                // cooler effect 
                pump = pump*pump;

                vec3 newPosition = position + normal * pump * pumpRange;

                gl_Position = projectionMatrix * modelViewMatrix * rotateY(time*rotationSpeed) * vec4( newPosition, 1.0 );
            }
        </script>

        <script id="fragmentPowerUpShader" type="x-shader/x-fragment">
            uniform float time;
            uniform vec2 resolution;

            uniform sampler2D uTexture;

            varying vec2 vUv;

            void main()	{

              vec4 textureColor = texture2D(uTexture, vUv);

              gl_FragColor = textureColor;
            }
        </script>

        <script id="vertexObstacleShader" type="x-shader/x-vertex">
          uniform float time;
          uniform float rotationSpeed;
          uniform float pumpRange;
          uniform float pumpSpeed;
          varying vec2 vUv;

          mat4 rotateY(float theta) {
            float c = cos(theta);
            float s = sin(theta);

            return mat4(
              vec4(c, 0, s, 0),
              vec4(0, 1, 0, 0),
              vec4(-s, 0, c, 0),
              vec4(0, 0, 0, 1)
            );
          }

          mat4 rotateZ(float theta) {
            float c = cos(theta);
            float s = sin(theta);

            return mat4(
              vec4(c, -s, 0, 0),
              vec4(s, c, 0, 0),
              vec4(0, 0, 1, 0),
              vec4(0, 0, 0, 1)
            );
          }

          void main()	{
              vUv = uv;

              float pump = mod(time * pumpSpeed, 2.0);

              if (pump > 1.0) {
                pump = 2.0 - pump;
              }

              // cooler effect 
              pump = pump*pump;

              vec3 newPosition = position * (1.0 + pump * pumpRange);

              gl_Position = projectionMatrix * modelViewMatrix * rotateY(time*rotationSpeed) * vec4( newPosition, 1.0 );
          }
      </script>

      <script id="fragmentObstacleShader" type="x-shader/x-fragment">
          uniform float time;
          uniform vec2 resolution;

          uniform vec3 mColor;

          varying vec2 vUv;

          void main()	{
            gl_FragColor = vec4(mColor, 1.0);
          }
      </script>
    </head>

    <body>
        <div id="canvas"></div>
        <div id="camera"></div>
        <script type="module" src="main.js"></script>
    </body>
</html>
